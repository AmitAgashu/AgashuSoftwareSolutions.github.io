/* AgaShu Softech Solutions - Consolidated Scripts
   Combines essential functions from: custom.js, modern-interactions.js, layout-fixes.js, text-visibility-fixes.js
   Created: July 13, 2025
*/

// Wait for document ready
document.addEventListener('DOMContentLoaded', function() {
  // Initialize components when jQuery is ready
  jQuery(function($) {
    // Remove preloader when page is ready
    setTimeout(function() {
      $('.preloader').fadeOut(500);
    }, 1000);
    
    // Mobile menu toggle fix
    $('.navbar-toggle').on('click', function() {
      $('.navbar-collapse').toggleClass('collapse in');
    });
    
    // Force navbar visibility
    var navbar = document.querySelector('.custom-navbar');
    if (navbar) {
      navbar.style.display = 'block';
      navbar.style.visibility = 'visible';
      navbar.style.opacity = '1';
      navbar.style.backgroundColor = '#667eea';
      navbar.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
    }
    
    // Make sure logo image is visible with proper styling for colored header
    var logoImg = document.querySelector('.logo-link img');
    if (logoImg) {
      logoImg.style.display = 'block';
      logoImg.style.visibility = 'visible';
      logoImg.style.opacity = '1';
      logoImg.style.maxHeight = '50px';
      logoImg.style.filter = 'brightness(0) invert(1)';
    }
    
    // Fix menu toggle on mobile
    var toggle = document.querySelector('.navbar-toggle');
    var menu = document.querySelector('.navbar-collapse');
    
    if (toggle && menu) {
      toggle.addEventListener('click', function(e) {
        if (menu.style.display === 'block') {
          menu.style.display = 'none';
        } else {
          menu.style.display = 'block';
        }
        e.preventDefault();
      });
    }
    
    // Text visibility enhancement
    const sectionTitles = document.querySelectorAll('.section-title strong, .section-title h1');
    sectionTitles.forEach(function(element) {
      element.style.color = '#ffffff';
      element.style.textShadow = '0 2px 4px rgba(0,0,0,0.3)';
    });
    
    // Portfolio filter links visibility
    const filterLinks = document.querySelectorAll('.filter-wrapper li a');
    filterLinks.forEach(function(link) {
      link.style.opacity = '1';
      link.style.color = '#ffffff';
      link.style.fontWeight = 'bold';
      link.style.textShadow = '0 1px 2px rgba(0,0,0,0.2)';
    });
    
    // ISOTOPE FILTER - Portfolio filtering
    if ($('.iso-box-wrapper').length > 0) { 
      var $container = $('.iso-box-wrapper'), 
          $imgs = $('.iso-box img');

      $container.imagesLoaded(function() {
        $container.isotope({
          layoutMode: 'fitRows',
          itemSelector: '.iso-box'
        });

        $imgs.load(function() {
          $container.isotope('reLayout');
        });
      });

      // Filter items on button click
      $('.filter-wrapper li a').click(function() {
        var $this = $(this), filterValue = $this.attr('data-filter');

        $container.isotope({ 
          filter: filterValue,
          animationOptions: { 
            duration: 750, 
            easing: 'linear', 
            queue: false
          }                
        });             

        // Don't proceed if already selected 
        if ($this.hasClass('selected')) { 
          return false; 
        }

        var filter_wrapper = $this.closest('.filter-wrapper');
        filter_wrapper.find('.selected').removeClass('selected');
        $this.addClass('selected');

        return false;
      });
    }
    
    // Smooth scrolling for navigation links
    $('a.smoothScroll').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({
            scrollTop: target.offset().top - 49
          }, 1000);
          return false;
        }
      }
    });
    
    // Initialize WOW.js for animations
    if (typeof WOW == 'function') {
      new WOW().init();
    }
    
    // Initialize Nivo Lightbox for portfolio
    if (typeof $('.portfolio-item a').nivoLightbox == 'function') {
      $('.portfolio-item a').nivoLightbox({
        effect: 'fadeScale'
      });
    }

    // Adjust service box heights for consistent appearance
    function equalizeServiceBoxHeights() {
      if ($(window).width() > 767) {
        var maxHeight = 0;
        $('.service-box').height('auto');
        $('.service-box').each(function() {
          if ($(this).height() > maxHeight) {
            maxHeight = $(this).height();
          }
        });
        $('.service-box').height(maxHeight);
      } else {
        $('.service-box').height('auto');
      }
    }

    // Run on document ready
    equalizeServiceBoxHeights();
    
    // Run on window resize
    $(window).resize(function() {
      equalizeServiceBoxHeights();
    });
  });
});
